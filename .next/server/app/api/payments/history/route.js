"use strict";(()=>{var e={};e.id=915,e.ids=[915],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},8678:e=>{e.exports=import("pg")},7474:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>u,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>d});var a=r(9303),s=r(8716),o=r(670),i=r(4948),c=e([i]);i=(c.then?(await c)():c)[0];let p=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/payments/history/route",pathname:"/api/payments/history",filename:"route",bundlePath:"app/api/payments/history/route"},resolvedPagePath:"/home/runner/work/secured-ajo/secured-ajo/app/api/payments/history/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:y}=p,h="/api/payments/history/route";function u(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:d})}n()}catch(e){n(e)}})},4948:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{GET:()=>c});var a=r(2995),s=r(9434),o=r(2596),i=e([a]);async function c(e){try{let t=await (0,s.ts)();if(!t)return(0,o.m)("Not authenticated");let{searchParams:r}=new URL(e.url),n=parseInt(r.get("page")||"1"),i=parseInt(r.get("limit")||"20"),c=(n-1)*i,u=await (0,a.IO)(`SELECT 
        t.id,
        t.type,
        t.amount,
        t.status,
        t.date,
        t.reference,
        t.payment_reference,
        t.description,
        t.metadata,
        g.name as group_name,
        g.id as group_id
       FROM transactions t
       LEFT JOIN groups g ON t.group_id = g.id
       WHERE t.user_id = $1
       ORDER BY t.date DESC
       LIMIT $2 OFFSET $3`,[t.userId,i,c]),p=await (0,a.IO)("SELECT COUNT(*) FROM transactions WHERE user_id = $1",[t.userId]),l=parseInt(p.rows[0].count),d=Math.ceil(l/i);return(0,o.Xj)({transactions:u.rows,pagination:{page:n,limit:i,total:l,totalPages:d}})}catch(e){return console.error("Get payment history error:",e),(0,o.Vd)("Failed to get payment history")}}a=(i.then?(await i)():i)[0],n()}catch(e){n(e)}})},2596:(e,t,r)=>{r.d(t,{VR:()=>s,Vd:()=>c,Xj:()=>a,m:()=>i,sm:()=>o});var n=r(7070);function a(e,t,r=200){return n.NextResponse.json({success:!0,data:e,message:t},{status:r})}function s(e,t=400,r){return n.NextResponse.json({success:!1,error:e,...r&&{details:r}},{status:t})}function o(e){return n.NextResponse.json({success:!1,error:"Validation failed",details:e},{status:422})}function i(e="Unauthorized"){return n.NextResponse.json({success:!1,error:e},{status:401})}function c(e="Internal server error"){return n.NextResponse.json({success:!1,error:e},{status:500})}},9434:(e,t,r)=>{r.d(t,{BV:()=>m,Gv:()=>l,I_:()=>f,P:()=>g,Wx:()=>w,c_:()=>p,ts:()=>x});var n=r(8691),a=r(6890),s=r(1463),o=r(1615);let i=new TextEncoder().encode(process.env.JWT_SECRET||"your-super-secret-jwt-key-min-32-characters"),c=process.env.JWT_ACCESS_TOKEN_EXPIRY||"15m",u=process.env.JWT_REFRESH_TOKEN_EXPIRY||"7d";async function p(e){return n.ZP.hash(e,12)}async function l(e,t){return n.ZP.compare(e,t)}async function d(e,t){return await new a.N({userId:e,email:t,type:"access"}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(c).sign(i)}async function y(e,t){return await new a.N({userId:e,email:t,type:"refresh"}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(u).sign(i)}async function h(e){try{let{payload:t}=await (0,s._)(e,i);return t}catch(e){throw Error("Invalid or expired token")}}async function m(e,t){let r=await d(e,t),n=await y(e,t),a=await (0,o.cookies)();return a.set("accessToken",r,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:900,path:"/"}),a.set("refreshToken",n,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),{accessToken:r,refreshToken:n}}async function w(){let e=await (0,o.cookies)();e.delete("accessToken"),e.delete("refreshToken")}async function x(){try{let e=await (0,o.cookies)(),t=e.get("accessToken")?.value;if(!t)return null;return await h(t)}catch(e){return null}}function g(){return Math.floor(1e5+9e5*Math.random()).toString()}function f(){let e=new Date;return e.setMinutes(e.getMinutes()+10),e}},2995:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{IO:()=>o,PS:()=>i});var a=r(8678),s=e([a]);if(a=(s.then?(await s)():s)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL environment variable is not set");let c=new a.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:1e4});async function o(e,t){let r=Date.now();try{let n=await c.query(e,t),a=Date.now()-r;return console.log("Executed query",{text:e,duration:a,rows:n.rowCount}),n}catch(t){throw console.error("Database query error:",{text:e,error:t}),t}}async function i(e){let t=await c.connect();try{await t.query("BEGIN");let r=await e(t);return await t.query("COMMIT"),r}catch(e){throw await t.query("ROLLBACK"),e}finally{t.release()}}c.on("error",e=>{console.error("Unexpected error on idle client",e),process.exit(-1)}),n()}catch(e){n(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972,795],()=>r(7474));module.exports=n})();