"use strict";(()=>{var e={};e.id=847,e.ids=[847],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},8678:e=>{e.exports=import("pg")},7451:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>c,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>m});var s=r(9303),n=r(8716),o=r(670),i=r(4677),u=e([i]);i=(u.then?(await u)():u)[0];let l=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/users/me/route",pathname:"/api/users/me",filename:"route",bundlePath:"app/api/users/me/route"},resolvedPagePath:"/home/runner/work/secured-ajo/secured-ajo/app/api/users/me/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:p}=l,f="/api/users/me/route";function c(){return(0,o.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:m})}a()}catch(e){a(e)}})},4677:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{GET:()=>c,PATCH:()=>l});var s=r(2995),n=r(9434),o=r(3208),i=r(2596),u=e([s]);async function c(){try{let e=await (0,n.ts)();if(!e)return(0,i.m)("Not authenticated");let t=await (0,s.IO)(`SELECT id, email, full_name, phone, is_verified, kyc_status, bvn, 
              profile_image, created_at, last_login_at
       FROM users WHERE id = $1`,[e.userId]);if(0===t.rows.length)return(0,i.VR)("User not found",404);let r=t.rows[0];return(0,i.Xj)({id:r.id,email:r.email,fullName:r.full_name,phone:r.phone,isVerified:r.is_verified,kycStatus:r.kyc_status,bvn:r.bvn,profileImage:r.profile_image,createdAt:r.created_at,lastLoginAt:r.last_login_at})}catch(e){return console.error("Get user profile error:",e),(0,i.Vd)("Failed to get user profile")}}async function l(e){try{let t=await (0,n.ts)();if(!t)return(0,i.m)("Not authenticated");let r=await e.json(),a=o.yC.safeParse(r);if(!a.success)return(0,i.sm)(a.error.format());let u=a.data,c=[],l=[],d=1;if(Object.entries(u).forEach(([e,t])=>{if(void 0!==t){let r=e.replace(/([A-Z])/g,"_$1").toLowerCase();c.push(`${r} = $${d}`),l.push(t),d++}}),0===c.length)return(0,i.VR)("No fields to update",400);l.push(t.userId);let m=`
      UPDATE users 
      SET ${c.join(", ")}, updated_at = CURRENT_TIMESTAMP
      WHERE id = $${d}
      RETURNING id, email, full_name, phone, is_verified, kyc_status, 
                bvn, profile_image, updated_at
    `,p=(await (0,s.IO)(m,l)).rows[0];return(0,i.Xj)({id:p.id,email:p.email,fullName:p.full_name,phone:p.phone,isVerified:p.is_verified,kycStatus:p.kyc_status,bvn:p.bvn,profileImage:p.profile_image,updatedAt:p.updated_at},"Profile updated successfully")}catch(e){return console.error("Update user profile error:",e),(0,i.Vd)("Failed to update user profile")}}s=(u.then?(await u)():u)[0],a()}catch(e){a(e)}})},2596:(e,t,r)=>{r.d(t,{VR:()=>n,Vd:()=>u,Xj:()=>s,m:()=>i,sm:()=>o});var a=r(7070);function s(e,t,r=200){return a.NextResponse.json({success:!0,data:e,message:t},{status:r})}function n(e,t=400,r){return a.NextResponse.json({success:!1,error:e,...r&&{details:r}},{status:t})}function o(e){return a.NextResponse.json({success:!1,error:"Validation failed",details:e},{status:422})}function i(e="Unauthorized"){return a.NextResponse.json({success:!1,error:e},{status:401})}function u(e="Internal server error"){return a.NextResponse.json({success:!1,error:e},{status:500})}},9434:(e,t,r)=>{r.d(t,{BV:()=>y,Gv:()=>d,I_:()=>g,P:()=>w,Wx:()=>h,c_:()=>l,ts:()=>_});var a=r(8691),s=r(6890),n=r(1463),o=r(1615);let i=new TextEncoder().encode(process.env.JWT_SECRET||"your-super-secret-jwt-key-min-32-characters"),u=process.env.JWT_ACCESS_TOKEN_EXPIRY||"15m",c=process.env.JWT_REFRESH_TOKEN_EXPIRY||"7d";async function l(e){return a.ZP.hash(e,12)}async function d(e,t){return a.ZP.compare(e,t)}async function m(e,t){return await new s.N({userId:e,email:t,type:"access"}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(u).sign(i)}async function p(e,t){return await new s.N({userId:e,email:t,type:"refresh"}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(c).sign(i)}async function f(e){try{let{payload:t}=await (0,n._)(e,i);return t}catch(e){throw Error("Invalid or expired token")}}async function y(e,t){let r=await m(e,t),a=await p(e,t),s=await (0,o.cookies)();return s.set("accessToken",r,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:900,path:"/"}),s.set("refreshToken",a,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),{accessToken:r,refreshToken:a}}async function h(){let e=await (0,o.cookies)();e.delete("accessToken"),e.delete("refreshToken")}async function _(){try{let e=await (0,o.cookies)(),t=e.get("accessToken")?.value;if(!t)return null;return await f(t)}catch(e){return null}}function w(){return Math.floor(1e5+9e5*Math.random()).toString()}function g(){let e=new Date;return e.setMinutes(e.getMinutes()+10),e}},2995:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{IO:()=>o,PS:()=>i});var s=r(8678),n=e([s]);if(s=(n.then?(await n)():n)[0],!process.env.DATABASE_URL)throw Error("DATABASE_URL environment variable is not set");let u=new s.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:1e4});async function o(e,t){let r=Date.now();try{let a=await u.query(e,t),s=Date.now()-r;return console.log("Executed query",{text:e,duration:s,rows:a.rowCount}),a}catch(t){throw console.error("Database query error:",{text:e,error:t}),t}}async function i(e){let t=await u.connect();try{await t.query("BEGIN");let r=await e(t);return await t.query("COMMIT"),r}catch(e){throw await t.query("ROLLBACK"),e}finally{t.release()}}u.on("error",e=>{console.error("Unexpected error on idle client",e),process.exit(-1)}),a()}catch(e){a(e)}})},3208:(e,t,r)=>{r.d(t,{Ln:()=>o,dm:()=>n,hE:()=>c,if:()=>s,m7:()=>i,yC:()=>u});var a=r(1067);let s=a.Ry({fullName:a.Z_().min(2,"Full name must be at least 2 characters"),email:a.Z_().email("Invalid email address"),phone:a.Z_().min(10,"Phone number must be at least 10 digits"),password:a.Z_().min(8,"Password must be at least 8 characters").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[a-z]/,"Password must contain at least one lowercase letter").regex(/[0-9]/,"Password must contain at least one number").regex(/[^A-Za-z0-9]/,"Password must contain at least one special character")}),n=a.Ry({email:a.Z_().email("Invalid email address"),password:a.Z_().min(1,"Password is required")}),o=a.Ry({email:a.Z_().email("Invalid email address"),otp:a.Z_().length(6,"OTP must be 6 digits")}),i=a.Ry({email:a.Z_().email("Invalid email address")});a.Ry({email:a.Z_().email("Invalid email address")}),a.Ry({token:a.Z_(),newPassword:a.Z_().min(8,"Password must be at least 8 characters").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[a-z]/,"Password must contain at least one lowercase letter").regex(/[0-9]/,"Password must contain at least one number").regex(/[^A-Za-z0-9]/,"Password must contain at least one special character")});let u=a.Ry({fullName:a.Z_().min(2).optional(),phone:a.Z_().min(10).optional(),bvn:a.Z_().length(11).optional(),profileImage:a.Z_().url().optional()}),c=a.Ry({groupId:a.Z_().uuid("Invalid group ID"),amount:a.Rx().positive("Amount must be positive"),type:a.Km(["contribution","security_deposit"])});a.Ry({name:a.Z_().min(3,"Group name must be at least 3 characters"),description:a.Z_().optional(),contributionAmount:a.Rx().positive("Contribution amount must be positive"),frequency:a.Km(["daily","weekly","monthly"]),totalMembers:a.Rx().min(2).max(50),securityDepositPercentage:a.Rx().min(0).max(100),serviceFeePercentage:a.Rx().min(0).max(100).default(10),startDate:a.Z_().datetime().optional()}),a.Ry({groupId:a.Z_().uuid("Invalid group ID")})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972,795,67],()=>r(7451));module.exports=a})();